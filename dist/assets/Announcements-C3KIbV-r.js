import{j as e}from"./ui-B52-YLhK.js";import{r as n}from"./vendor-BcRnq7Bv.js";import{u as F,s as o,r as d,C as m,b as f,B as j,t as c,I as T,i as E,j as q,k as M,l as I,m as g,v as P,e as y,M as B,h as x,d as O,A as V,n as H,o as L,g as R}from"./index-CwOpWW1C.js";import{D as U,a as W,b as $,c as z,d as G,e as J}from"./dialog-C51BNC8a.js";import{T as K}from"./textarea-CV_jgnQH.js";import{P as Q}from"./plus-B1hUgeE_.js";import{T as X}from"./triangle-alert-CUPz6xIU.js";import{f as Y}from"./utils-BT0ItAA-.js";import"./supabase-B83k6j1z.js";function ce(){const{profile:r}=F(),[h,N]=n.useState([]),[w,v]=n.useState(!0),[b,p]=n.useState(!1),[C,_]=n.useState([]),[t,l]=n.useState({title:"",content:"",department:"company-wide",is_priority:!1});n.useEffect(()=>{u(),D()},[]);const u=async()=>{try{let s=o.from("announcements").select(`
          *,
          profiles!announcements_author_id_fkey(*)
        `).order("created_at",{ascending:!1});r?.role!=="super_admin"&&r?.department&&(s=s.or(`department.is.null,department.eq.${r.department}`));const{data:a,error:i}=await s;if(i)throw i;N(a||[])}catch(s){console.error("Error fetching announcements:",s),d.error("Failed to fetch announcements")}finally{v(!1)}},D=async()=>{try{const{data:s,error:a}=await o.from("profiles").select("department").eq("is_active",!0);if(a)throw a;const i=[...new Set(s?.map(k=>k.department)||[])];_(i.sort())}catch(s){console.error("Error fetching departments:",s)}},A=async s=>{if(s.preventDefault(),!!r)try{const{error:a}=await o.from("announcements").insert({title:t.title,content:t.content,author_id:r.id,department:t.department==="company-wide"?null:t.department||null,is_priority:t.is_priority});if(a)throw a;d.success("Announcement published successfully"),p(!1),l({title:"",content:"",department:"company-wide",is_priority:!1}),u()}catch(a){console.error("Error creating announcement:",a),d.error("Failed to publish announcement")}},S=s=>s?e.jsx(x,{variant:"outline",className:"bg-blue-100 text-blue-800",children:s}):e.jsx(x,{variant:"outline",className:"bg-green-100 text-green-800",children:"Company-wide"});return r?w?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid gap-4",children:[...Array(3)].map((s,a)=>e.jsx(m,{children:e.jsxs(f,{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})},a))})}):e.jsxs("div",{className:"space-y-6 w-full overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"Announcements"}),e.jsx("p",{className:"text-muted-foreground text-sm sm:text-base",children:"Stay updated with company news and updates"})]}),r?.role==="super_admin"&&e.jsx("div",{className:"flex-shrink-0",children:e.jsxs(U,{open:b,onOpenChange:p,children:[e.jsx(W,{asChild:!0,children:e.jsxs(j,{className:"w-full sm:w-auto",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"New Announcement"}),e.jsx("span",{className:"sm:hidden",children:"New"})]})}),e.jsxs($,{className:"max-w-2xl",children:[e.jsxs(z,{children:[e.jsx(G,{children:"Create New Announcement"}),e.jsx(J,{children:"Create a new announcement to share with your team or the entire company"})]}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"title",children:"Title"}),e.jsx(T,{id:"title",placeholder:"Enter announcement title...",value:t.title,onChange:s=>l({...t,title:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"content",children:"Content"}),e.jsx(K,{id:"content",placeholder:"Write your announcement content here...",value:t.content,onChange:s=>l({...t,content:s.target.value}),rows:6,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"department",children:"Department (Optional)"}),e.jsxs(E,{value:t.department,onValueChange:s=>l({...t,department:s}),children:[e.jsx(q,{children:e.jsx(M,{placeholder:"Select department or leave empty for company-wide"})}),e.jsxs(I,{children:[e.jsx(g,{value:"company-wide",children:"Company-wide"}),C.map(s=>e.jsx(g,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{id:"is_priority",checked:t.is_priority,onCheckedChange:s=>l({...t,is_priority:!!s})}),e.jsx(c,{htmlFor:"is_priority",children:"Mark as priority announcement"})]}),e.jsx(j,{type:"submit",className:"w-full",children:"Publish Announcement"})]})]})]})})]}),h.length===0?e.jsx(m,{children:e.jsx(y,{className:"py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold",children:"No announcements"}),e.jsx("p",{className:"text-muted-foreground",children:"Check back later for company updates"})]})})}):e.jsx("div",{className:"space-y-4",children:h.map(s=>e.jsxs(m,{className:s.is_priority?"border-orange-200 bg-orange-50":"",children:[e.jsx(f,{children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.is_priority&&e.jsxs(x,{className:"bg-orange-100 text-orange-800",children:[e.jsx(X,{className:"mr-1 h-3 w-3"}),"Priority"]}),S(s.department)]}),e.jsx(O,{className:"text-lg sm:text-xl break-words",children:s.title}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsxs(V,{className:"h-6 w-6 flex-shrink-0",children:[e.jsx(H,{src:s.profiles.profile_picture||void 0}),e.jsx(L,{className:"text-xs",children:s.profiles.full_name.split(" ").map(a=>a[0]).join("")})]}),e.jsx("span",{className:"truncate",children:s.profiles.full_name})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:Y(new Date(s.created_at),"MMM dd, yyyy")})]})]})]})})}),e.jsx(y,{children:e.jsx("p",{className:"whitespace-pre-wrap text-sm leading-relaxed text-muted-foreground",children:s.content})})]},s.id))})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Profile Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"Unable to load your profile information."})]})})}export{ce as Announcements};
