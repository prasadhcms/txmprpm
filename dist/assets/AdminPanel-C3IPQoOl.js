import{j as e}from"./ui-B52-YLhK.js";import{r as i}from"./vendor-BcRnq7Bv.js";import{c as T,u as me,w as xe,s as D,r as d,C as u,b as N,B as g,t as r,I as c,i as o,j as m,k as x,l as h,m as n,D as B,d as F,U as k,e as f,H as V,A as he,n as je,o as ue,q as pe,K as ge,g as fe,h as y}from"./index-CwOpWW1C.js";import{D as H,a as ve,b as J,c as z,d as X,e as G}from"./dialog-C51BNC8a.js";import{P as Ne}from"./plus-B1hUgeE_.js";import{S as ye}from"./search-CElmDAbQ.js";import{B as we}from"./building-CFEQ3fjO.js";import{P as _e}from"./phone-C23XvDq8.js";import{M as be}from"./map-pin-OatoSQae.js";import{C as Se}from"./circle-check-CjnywA-A.js";import{f as Ce}from"./utils-BT0ItAA-.js";import"./supabase-B83k6j1z.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=T("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=T("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=T("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);function Ue(){const{profile:I}=me(),[j,W]=i.useState([]),[Y,$]=i.useState(!0),[v,Q]=i.useState(""),[w,Z]=i.useState("all"),[_,ee]=i.useState("all"),[se,L]=i.useState(!1),[ae,b]=i.useState(!1),[O,R]=i.useState(null),[S,C]=i.useState(!1),[a,t]=i.useState({email:"",full_name:"",role:"employee",department:"",job_title:"",phone:"",location:"",joining_date:new Date().toISOString().split("T")[0]}),A=["General","Engineering","Marketing","Sales","HR","Finance","Operations","IT","Customer Support"],q=["Office - Main Building","Office - Branch Location","Remote - Home","Remote - Co-working Space","Field Work","Other"];if(I?.role!=="super_admin"&&I?.role!=="manager")return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"mx-auto h-12 w-12 text-red-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground",children:"You don't have permission to access the admin panel."})]});i.useEffect(()=>{E()},[]);const E=async()=>{try{const{data:s,error:l}=await D.from("profiles").select("*").order("created_at",{ascending:!1});if(l)throw l;W(s||[])}catch(s){console.error("Error fetching employees:",s),d.error("Failed to fetch employees")}finally{$(!1)}},le=async s=>{if(s.preventDefault(),!a.email||!a.full_name||!a.department){d.error("Please fill in all required fields");return}C(!0);try{const{error:l}=await D.from("profiles").insert({email:a.email,full_name:a.full_name,role:a.role,department:a.department,job_title:a.job_title,phone:a.phone,location:a.location,joining_date:a.joining_date});if(l)throw l;d.success("Employee added successfully"),L(!1),P(),E()}catch(l){console.error("Error adding employee:",l),d.error("Failed to add employee")}finally{C(!1)}},te=async s=>{if(s.preventDefault(),!!O){C(!0);try{const{error:l}=await D.from("profiles").update({full_name:a.full_name,role:a.role,department:a.department,job_title:a.job_title,phone:a.phone,location:a.location,joining_date:a.joining_date}).eq("id",O.id);if(l)throw l;d.success("Employee updated successfully"),b(!1),R(null),P(),E()}catch(l){console.error("Error updating employee:",l),d.error("Failed to update employee")}finally{C(!1)}}},re=async s=>{try{const{error:l}=await D.from("profiles").update({is_active:!s.is_active}).eq("id",s.id);if(l)throw l;d.success(`Employee ${s.is_active?"deactivated":"activated"} successfully`),E()}catch(l){console.error("Error updating employee status:",l),d.error("Failed to update employee status")}},P=()=>{t({email:"",full_name:"",role:"employee",department:"",job_title:"",phone:"",location:"",joining_date:new Date().toISOString().split("T")[0]})},ne=s=>{R(s),t({email:s.email,full_name:s.full_name,role:s.role,department:s.department,job_title:s.job_title||"",phone:s.phone||"",location:s.location,joining_date:s.joining_date||new Date().toISOString().split("T")[0]}),b(!0)},ie=s=>{switch(s){case"super_admin":return e.jsxs(y,{className:"bg-red-100 text-red-800",children:[e.jsx(V,{className:"mr-1 h-3 w-3"}),"Super Admin"]});case"manager":return e.jsxs(y,{className:"bg-blue-100 text-blue-800",children:[e.jsx(k,{className:"mr-1 h-3 w-3"}),"Manager"]});default:return e.jsxs(y,{className:"bg-gray-100 text-gray-800",children:[e.jsx(M,{className:"mr-1 h-3 w-3"}),"Employee"]})}},ce=s=>s?e.jsxs(y,{className:"bg-green-100 text-green-800",children:[e.jsx(Se,{className:"mr-1 h-3 w-3"}),"Active"]}):e.jsxs(y,{className:"bg-red-100 text-red-800",children:[e.jsx(K,{className:"mr-1 h-3 w-3"}),"Inactive"]}),U=j.filter(s=>{const l=s.full_name.toLowerCase().includes(v.toLowerCase())||s.email.toLowerCase().includes(v.toLowerCase())||s.department.toLowerCase().includes(v.toLowerCase()),de=w==="all"||s.department===w,oe=_==="all"||s.role===_;return l&&de&&oe}),p={total:j.length,active:j.filter(s=>s.is_active).length,inactive:j.filter(s=>!s.is_active).length,admins:j.filter(s=>s.role==="super_admin").length,managers:j.filter(s=>s.role==="manager").length,employees:j.filter(s=>s.role==="employee").length};return Y?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((s,l)=>e.jsx(u,{children:e.jsxs(N,{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})},l))})}):e.jsxs("div",{className:"space-y-6 w-full overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"User Management"}),e.jsx("p",{className:"text-muted-foreground text-sm sm:text-base",children:"Manage employees, roles, and organizational structure"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs(H,{open:se,onOpenChange:L,children:[e.jsx(ve,{asChild:!0,children:e.jsxs(g,{className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Add Employee"}),e.jsx("span",{className:"sm:hidden",children:"Add"})]})}),e.jsxs(J,{className:"max-w-2xl",children:[e.jsxs(z,{children:[e.jsx(X,{children:"Add New Employee"}),e.jsx(G,{children:"Create a new employee account with their basic information and role assignment."})]}),e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"email",children:"Email *"}),e.jsx(c,{id:"email",type:"email",placeholder:"john@company.com",value:a.email,onChange:s=>t({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"full_name",children:"Full Name *"}),e.jsx(c,{id:"full_name",placeholder:"John Doe",value:a.full_name,onChange:s=>t({...a,full_name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"role",children:"Role *"}),e.jsxs(o,{value:a.role,onValueChange:s=>t({...a,role:s}),children:[e.jsx(m,{children:e.jsx(x,{})}),e.jsxs(h,{children:[e.jsx(n,{value:"employee",children:"Employee"}),e.jsx(n,{value:"manager",children:"Manager"}),e.jsx(n,{value:"super_admin",children:"Super Admin"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"department",children:"Department *"}),e.jsxs(o,{value:a.department,onValueChange:s=>t({...a,department:s}),children:[e.jsx(m,{children:e.jsx(x,{placeholder:"Select department"})}),e.jsx(h,{children:A.map(s=>e.jsx(n,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"job_title",children:"Job Title"}),e.jsx(c,{id:"job_title",placeholder:"Software Engineer",value:a.job_title,onChange:s=>t({...a,job_title:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"phone",children:"Phone"}),e.jsx(c,{id:"phone",placeholder:"+1 (555) 123-4567",value:a.phone,onChange:s=>t({...a,phone:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"location",children:"Location"}),e.jsxs(o,{value:a.location,onValueChange:s=>t({...a,location:s}),children:[e.jsx(m,{children:e.jsx(x,{placeholder:"Select location"})}),e.jsx(h,{children:q.map(s=>e.jsx(n,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"joining_date",children:"Joining Date"}),e.jsx(c,{id:"joining_date",type:"date",value:a.joining_date,onChange:s=>t({...a,joining_date:s.target.value})})]})]}),e.jsx(g,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding..."]}):"Add Employee"})]})]})]})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(u,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Total Users"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.total}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[p.active," active, ",p.inactive," inactive"]})]})]}),e.jsxs(u,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Employees"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.employees}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Regular employees"})]})]}),e.jsxs(u,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Managers"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.managers}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Department managers"})]})]}),e.jsxs(u,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium",children:"Admins"}),e.jsx(V,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(f,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.admins}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Super administrators"})]})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(c,{placeholder:"Search employees...",value:v,onChange:s=>Q(s.target.value),className:"pl-10"})]}),e.jsxs(o,{value:w,onValueChange:Z,children:[e.jsx(m,{className:"w-[180px]",children:e.jsx(x,{placeholder:"All Departments"})}),e.jsxs(h,{children:[e.jsx(n,{value:"all",children:"All Departments"}),A.map(s=>e.jsx(n,{value:s,children:s},s))]})]}),e.jsxs(o,{value:_,onValueChange:ee,children:[e.jsx(m,{className:"w-[140px]",children:e.jsx(x,{placeholder:"All Roles"})}),e.jsxs(h,{children:[e.jsx(n,{value:"all",children:"All Roles"}),e.jsx(n,{value:"employee",children:"Employee"}),e.jsx(n,{value:"manager",children:"Manager"}),e.jsx(n,{value:"super_admin",children:"Super Admin"})]})]})]})}),e.jsx("div",{className:"grid gap-4",children:U.length===0?e.jsx(u,{children:e.jsx(f,{className:"py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(k,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold",children:"No employees found"}),e.jsx("p",{className:"text-muted-foreground",children:v||w!=="all"||_!=="all"?"Try adjusting your search criteria":"Start by adding your first employee"})]})})}):U.map(s=>e.jsx(u,{className:"hover:shadow-md transition-shadow",children:e.jsx(f,{className:"p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start space-x-4 flex-1 min-w-0",children:[e.jsxs(he,{className:"h-12 w-12",children:[e.jsx(je,{src:s.profile_picture||void 0}),e.jsx(ue,{children:s.full_name.split(" ").map(l=>l[0]).join("")})]}),e.jsxs("div",{className:"space-y-1 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h3",{className:"font-semibold truncate",title:s.full_name,children:s.full_name}),ie(s.role),ce(s.is_active)]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[e.jsx(pe,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",title:s.email,children:s.email})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{children:s.department})]}),s.job_title&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{children:s.job_title})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-muted-foreground",children:[s.phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_e,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{children:s.phone})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{children:s.location})]}),s.joining_date&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{children:["Joined ",Ce(new Date(s.joining_date),"MMM yyyy")]})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto self-stretch sm:self-center",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>ne(s),className:"flex-1 sm:flex-none",children:[e.jsx(Ee,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsx(g,{variant:s.is_active?"destructive":"default",size:"sm",onClick:()=>re(s),className:"flex-1 sm:flex-none",children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Deactivate"]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Activate"]})})]})]})})},s.id))}),e.jsx(H,{open:ae,onOpenChange:b,children:e.jsxs(J,{className:"max-w-2xl",children:[e.jsxs(z,{children:[e.jsx(X,{children:"Edit Employee"}),e.jsx(G,{children:"Update employee information and role assignments. Email cannot be changed."})]}),e.jsxs("form",{onSubmit:te,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit_email",children:"Email"}),e.jsx(c,{id:"edit_email",type:"email",value:a.email,disabled:!0,className:"bg-gray-50"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email cannot be changed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit_full_name",children:"Full Name *"}),e.jsx(c,{id:"edit_full_name",placeholder:"John Doe",value:a.full_name,onChange:s=>t({...a,full_name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit_role",children:"Role"}),e.jsxs(o,{value:a.role,onValueChange:s=>t({...a,role:s}),children:[e.jsx(m,{children:e.jsx(x,{})}),e.jsxs(h,{children:[e.jsx(n,{value:"employee",children:"Employee"}),e.jsx(n,{value:"manager",children:"Manager"}),e.jsx(n,{value:"super_admin",children:"Super Admin"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit_department",children:"Department *"}),e.jsxs(o,{value:a.department,onValueChange:s=>t({...a,department:s}),children:[e.jsx(m,{children:e.jsx(x,{placeholder:"Select department"})}),e.jsx(h,{children:A.map(s=>e.jsx(n,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit_job_title",children:"Job Title"}),e.jsx(c,{id:"edit_job_title",placeholder:"Software Engineer",value:a.job_title,onChange:s=>t({...a,job_title:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit_phone",children:"Phone"}),e.jsx(c,{id:"edit_phone",placeholder:"+1 (555) 123-4567",value:a.phone,onChange:s=>t({...a,phone:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit_location",children:"Location"}),e.jsxs(o,{value:a.location,onValueChange:s=>t({...a,location:s}),children:[e.jsx(m,{children:e.jsx(x,{placeholder:"Select location"})}),e.jsx(h,{children:q.map(s=>e.jsx(n,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"edit_joining_date",children:"Joining Date"}),e.jsx(c,{id:"edit_joining_date",type:"date",value:a.joining_date,onChange:s=>t({...a,joining_date:s.target.value})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(g,{type:"submit",disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):"Update Employee"})]})]})]})})]})}export{Ue as AdminPanel};
