import{j as e}from"./ui-B52-YLhK.js";import{r as m}from"./vendor-BcRnq7Bv.js";import{c as q,u as z,s as N,r as x,C as i,b as u,B as j,t as g,i as H,j as X,k as Y,l as $,m as y,I as A,h as n,e as h,g as G,d as b,f as w}from"./index-CwOpWW1C.js";import{T as J,a as K,b as M,c as C}from"./tabs-D5GWy4pF.js";import{D as Q,a as W,b as Z,c as ee,d as se,e as ae}from"./dialog-C51BNC8a.js";import{T as te}from"./textarea-CV_jgnQH.js";import{P as re}from"./plus-B1hUgeE_.js";import{C as D}from"./circle-check-big-JwFVQrd3.js";import{C as F}from"./clock-NqfEd9ie.js";import{f as l}from"./utils-BT0ItAA-.js";import"./supabase-B83k6j1z.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=q("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function je(){const{profile:a}=z(),[v,P]=m.useState([]),[I,B]=m.useState(!0),[O,S]=m.useState(!1),[t,o]=m.useState({leave_type:"",start_date:"",end_date:"",reason:""});m.useEffect(()=>{f()},[a]);const f=async()=>{try{let s=N.from("leave_requests").select(`
          *,
          profiles!leave_requests_employee_id_fkey(*)
        `).order("created_at",{ascending:!1});a?.role==="employee"&&(s=s.eq("employee_id",a.id));const{data:r,error:d}=await s;if(d)throw d;P(r||[])}catch(s){console.error("Error fetching leave requests:",s),x.error("Failed to fetch leave requests")}finally{B(!1)}},U=async s=>{if(s.preventDefault(),!!a)try{const r=new Date(t.start_date),d=new Date(t.end_date),c=Math.ceil((d.getTime()-r.getTime())/(1e3*60*60*24))+1,{error:k}=await N.from("leave_requests").insert({employee_id:a.id,leave_type:t.leave_type,start_date:t.start_date,end_date:t.end_date,days_count:c,reason:t.reason,status:"pending"});if(k)throw k;x.success("Leave request submitted successfully"),S(!1),o({leave_type:"",start_date:"",end_date:"",reason:""}),f()}catch(r){console.error("Error submitting leave request:",r),x.error("Failed to submit leave request")}},T=async(s,r,d)=>{try{const{error:c}=await N.from("leave_requests").update({status:r,manager_id:a?.id,manager_comments:d,updated_at:new Date().toISOString()}).eq("id",s);if(c)throw c;x.success(`Leave request ${r} successfully`),f()}catch(c){console.error("Error updating leave request:",c),x.error("Failed to update leave request")}},L=s=>{switch(s){case"approved":return e.jsxs(n,{className:"bg-green-100 text-green-800",children:[e.jsx(D,{className:"mr-1 h-3 w-3"}),"Approved"]});case"rejected":return e.jsxs(n,{className:"bg-red-100 text-red-800",children:[e.jsx(E,{className:"mr-1 h-3 w-3"}),"Rejected"]});default:return e.jsxs(n,{className:"bg-yellow-100 text-yellow-800",children:[e.jsx(F,{className:"mr-1 h-3 w-3"}),"Pending"]})}},_=s=>{switch(s){case"vacation":return"bg-blue-100 text-blue-800";case"sick":return"bg-red-100 text-red-800";case"personal":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},p=v.filter(s=>s.status==="pending"),R=v.filter(s=>s.employee_id===a?.id),V=()=>a?.role==="manager"||a?.role==="super_admin"?"pending-approvals":"my-requests";return I?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid gap-4",children:[...Array(3)].map((s,r)=>e.jsx(i,{children:e.jsxs(u,{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})},r))})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Leave Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your leave requests and approvals"})]}),e.jsxs(Q,{open:O,onOpenChange:S,children:[e.jsx(W,{asChild:!0,children:e.jsxs(j,{children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Apply for Leave"]})}),e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Apply for Leave"}),e.jsx(ae,{children:"Fill out the form to request leave. Your manager will be notified for approval."})]}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"leave_type",children:"Leave Type"}),e.jsxs(H,{value:t.leave_type,onValueChange:s=>o({...t,leave_type:s}),children:[e.jsx(X,{children:e.jsx(Y,{placeholder:"Select leave type"})}),e.jsxs($,{children:[e.jsx(y,{value:"vacation",children:"Vacation"}),e.jsx(y,{value:"sick",children:"Sick Leave"}),e.jsx(y,{value:"personal",children:"Personal"}),e.jsx(y,{value:"emergency",children:"Emergency"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"start_date",children:"Start Date"}),e.jsx(A,{id:"start_date",type:"date",value:t.start_date,onChange:s=>o({...t,start_date:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"end_date",children:"End Date"}),e.jsx(A,{id:"end_date",type:"date",value:t.end_date,onChange:s=>o({...t,end_date:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"reason",children:"Reason"}),e.jsx(te,{id:"reason",placeholder:"Please provide a reason for your leave request...",value:t.reason,onChange:s=>o({...t,reason:s.target.value}),required:!0})]}),e.jsx(j,{type:"submit",className:"w-full",children:"Submit Request"})]})]})]})]}),e.jsxs(J,{defaultValue:V(),className:"space-y-4",children:[e.jsxs(K,{children:[e.jsx(M,{value:"my-requests",children:"My Requests"}),(a?.role==="manager"||a?.role==="super_admin")&&e.jsxs(M,{value:"pending-approvals",children:["Pending Approvals",p.length>0&&e.jsx(n,{className:"ml-2 bg-red-500",children:p.length})]}),a?.role==="super_admin"&&e.jsx(M,{value:"all-requests",children:"All Requests"})]}),e.jsx(C,{value:"my-requests",className:"space-y-4",children:R.length===0?e.jsx(i,{children:e.jsx(h,{className:"py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(G,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold",children:"No leave requests"}),e.jsx("p",{className:"text-muted-foreground",children:"You haven't submitted any leave requests yet"})]})})}):e.jsx("div",{className:"grid gap-4",children:R.map(s=>e.jsxs(i,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(n,{variant:"outline",className:_(s.leave_type),children:s.leave_type.toUpperCase()}),s.days_count," day",s.days_count>1?"s":""]}),e.jsxs(w,{children:[l(new Date(s.start_date),"MMM dd, yyyy")," - ",l(new Date(s.end_date),"MMM dd, yyyy")]})]}),L(s.status)]})}),e.jsxs(h,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:[e.jsx("strong",{children:"Reason:"})," ",s.reason]}),s.manager_comments&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Manager Comments:"})," ",s.manager_comments]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Submitted on ",l(new Date(s.created_at),"MMM dd, yyyy")]})]})]},s.id))})}),(a?.role==="manager"||a?.role==="super_admin")&&e.jsx(C,{value:"pending-approvals",className:"space-y-4",children:p.length===0?e.jsx(i,{children:e.jsx(h,{className:"py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(D,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold",children:"No pending requests"}),e.jsx("p",{className:"text-muted-foreground",children:"All leave requests have been processed"})]})})}):e.jsx("div",{className:"grid gap-4",children:p.map(s=>e.jsxs(i,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[s.profiles.full_name,e.jsx(n,{variant:"outline",className:_(s.leave_type),children:s.leave_type.toUpperCase()})]}),e.jsxs(w,{children:[s.profiles.department," • ",s.days_count," day",s.days_count>1?"s":""]})]}),e.jsxs(n,{className:"bg-yellow-100 text-yellow-800",children:[e.jsx(F,{className:"mr-1 h-3 w-3"}),"Pending"]})]})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Duration:"})," ",l(new Date(s.start_date),"MMM dd, yyyy")," - ",l(new Date(s.end_date),"MMM dd, yyyy")]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Reason:"})," ",s.reason]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Submitted on ",l(new Date(s.created_at),"MMM dd, yyyy")]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{onClick:()=>T(s.id,"approved"),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Approve"]}),e.jsxs(j,{variant:"destructive",onClick:()=>T(s.id,"rejected"),children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Reject"]})]})]})})]},s.id))})}),a?.role==="super_admin"&&e.jsx(C,{value:"all-requests",className:"space-y-4",children:e.jsx("div",{className:"grid gap-4",children:v.map(s=>e.jsxs(i,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[s.profiles.full_name,e.jsx(n,{variant:"outline",className:_(s.leave_type),children:s.leave_type.toUpperCase()})]}),e.jsxs(w,{children:[s.profiles.department," • ",s.days_count," day",s.days_count>1?"s":""]})]}),L(s.status)]})}),e.jsxs(h,{children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Duration:"})," ",l(new Date(s.start_date),"MMM dd, yyyy")," - ",l(new Date(s.end_date),"MMM dd, yyyy")]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Reason:"})," ",s.reason]}),s.manager_comments&&e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Manager Comments:"})," ",s.manager_comments]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Submitted on ",l(new Date(s.created_at),"MMM dd, yyyy")]})]})]},s.id))})})]})]})}export{je as LeaveManagement};
