import{c as f,s as p,B as k,D as F,t as T,y as R,z as M,r as h}from"./index-CwOpWW1C.js";import{j as t}from"./ui-B52-YLhK.js";import{r as v}from"./vendor-BcRnq7Bv.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=f("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=f("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=f("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=f("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=f("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);class j{static async fileToBase64(r){return new Promise((a,e)=>{const s=new FileReader;s.readAsDataURL(r),s.onload=()=>a(s.result),s.onerror=l=>e(l)})}static async resizeImage(r,a=400,e=400,s=.8){return new Promise(l=>{const o=document.createElement("canvas"),u=o.getContext("2d"),m=new Image;m.onload=()=>{let{width:c,height:g}=m;c>g?c>a&&(g=g*a/c,c=a):g>e&&(c=c*e/g,g=e),o.width=c,o.height=g,u.drawImage(m,0,0,c,g),o.toBlob(y=>{const w=new File([y],r.name,{type:r.type,lastModified:Date.now()});l(w)},r.type,s)},m.src=URL.createObjectURL(r)})}static async uploadProfilePictureFallback(r,a){try{if(!r.type.startsWith("image/"))return{error:"Please select an image file"};if(r.size>2*1024*1024)return{error:"Image size must be less than 2MB for profile pictures"};const e=await this.resizeImage(r,300,300,.7);return{url:await this.fileToBase64(e)}}catch(e){return console.error("Error processing image:",e),{error:e.message||"Failed to process image"}}}static async uploadProjectImageFallback(r,a){try{if(!r.type.startsWith("image/"))return{error:"Please select an image file"};if(r.size>3*1024*1024)return{error:"Image size must be less than 3MB for project images"};const e=await this.resizeImage(r,800,600,.8);return{url:await this.fileToBase64(e)}}catch(e){return console.error("Error processing project image:",e),{error:e.message||"Failed to process image"}}}static isBase64Image(r){return r.startsWith("data:image/")}static getOptimizedImageUrl(r,a){if(this.isBase64Image(r)||!r||!r.includes("supabase"))return r;const e=new URLSearchParams;return a?.width&&e.append("width",a.width.toString()),a?.height&&e.append("height",a.height.toString()),a?.quality&&e.append("quality",a.quality.toString()),e.toString()?`${r}?${e.toString()}`:r}}class P{static BUCKETS={PROFILES:"profile-images",PROJECTS:"project-images"};static async initializeBuckets(){try{const{data:r,error:a}=await p.storage.listBuckets();if(a){console.log("Cannot check existing buckets, skipping initialization");return}const e=r?.map(s=>s.id)||[];e.includes(this.BUCKETS.PROFILES)||(await p.storage.createBucket(this.BUCKETS.PROFILES,{public:!0,allowedMimeTypes:["image/jpeg","image/png","image/webp","image/gif"],fileSizeLimit:5242880}),console.log("Created profile-images bucket")),e.includes(this.BUCKETS.PROJECTS)||(await p.storage.createBucket(this.BUCKETS.PROJECTS,{public:!0,allowedMimeTypes:["image/jpeg","image/png","image/webp","image/gif"],fileSizeLimit:10485760}),console.log("Created project-images bucket")),e.includes(this.BUCKETS.PROFILES)&&e.includes(this.BUCKETS.PROJECTS)&&console.log("Storage buckets already exist")}catch{console.log("Storage buckets initialization skipped")}}static async uploadProfilePicture(r,a){try{if(!r.type.startsWith("image/"))return{error:"Please select an image file"};if(r.size>5*1024*1024)return{error:"Image size must be less than 5MB"};const e=r.name.split(".").pop()||"jpg",l=`profile_${Date.now()}.${e}`,{error:o}=await p.storage.from(this.BUCKETS.PROFILES).upload(l,r,{cacheControl:"3600",upsert:!0});if(o)return console.error("Upload error:",o.message),{error:`Upload failed: ${o.message}`};const{data:u}=p.storage.from(this.BUCKETS.PROFILES).getPublicUrl(l);return{url:u.publicUrl}}catch(e){return console.error("Error uploading profile picture:",e),{error:e.message||"Failed to upload image"}}}static async uploadProjectImage(r,a){try{if(!r.type.startsWith("image/"))return{error:"Please select an image file"};if(r.size>10*1024*1024)return{error:"Image size must be less than 10MB"};const e=r.name.split(".").pop()||"jpg",l=`project_${Date.now()}.${e}`,{error:o}=await p.storage.from(this.BUCKETS.PROJECTS).upload(l,r,{cacheControl:"3600",upsert:!0});if(o)return console.error("Upload error:",o.message),{error:`Upload failed: ${o.message}`};const{data:u}=p.storage.from(this.BUCKETS.PROJECTS).getPublicUrl(l);return{url:u.publicUrl}}catch(e){return console.error("Error uploading project image:",e),{error:e.message||"Failed to upload image"}}}static async deleteImage(r,a){try{const e=a==="profiles"?this.BUCKETS.PROFILES:this.BUCKETS.PROJECTS,s=r.split("/"),l=s[s.length-1],{error:o}=await p.storage.from(e).remove([l]);if(o)throw o;return!0}catch(e){return console.error("Error deleting image:",e),!1}}static getOptimizedImageUrl(r,a){if(!r||!r.includes("supabase"))return r;const e=new URLSearchParams;return a?.width&&e.append("width",a.width.toString()),a?.height&&e.append("height",a.height.toString()),a?.quality&&e.append("quality",a.quality.toString()),e.toString()?`${r}?${e.toString()}`:r}}function J({onImageUploaded:b,onImageRemoved:r,currentImages:a=[],maxImages:e=5,bucket:s,userId:l,className:o="",accept:u="image/*",onUploadStateChange:m}){const c=v.useRef(null),[g,y]=v.useState(!1),[w,x]=v.useState(!1),E=async i=>{if(!i||i.length===0)return;if(a.length>=e){h.error(`Maximum ${e} images allowed`);return}const d=i[0];if(!d.type.startsWith("image/")){h.error("Please select an image file");return}const S=s==="profiles"?5*1024*1024:10*1024*1024;if(d.size>S){h.error(`Image size must be less than ${S/(1024*1024)}MB`);return}y(!0),m?.(!0);try{let n;s==="profiles"?(n=await P.uploadProfilePicture(d,l),n.error&&n.error.includes("row-level security")&&(console.log("Storage RLS issue, using base64 fallback..."),n=await j.uploadProfilePictureFallback(d,l))):(n=await P.uploadProjectImage(d,l),n.error&&n.error.includes("row-level security")&&(console.log("Storage RLS issue for projects, using base64 fallback..."),n=await j.uploadProjectImageFallback(d,l))),n.error?h.error(n.error):n.url?(b(n.url),h.success("Image uploaded successfully!")):h.error("Failed to upload image")}catch(n){console.error("Upload error:",n),h.error("Failed to upload image")}finally{y(!1),m?.(!1),c.current&&(c.current.value="")}},I=async i=>{r&&r(i),await P.deleteImage(i,s)},B=i=>{i.preventDefault(),x(!0)},z=i=>{i.preventDefault(),x(!1)},C=i=>{i.preventDefault(),x(!1),E(i.dataTransfer.files)};return t.jsxs("div",{className:`space-y-4 ${o}`,children:[t.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${w?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragOver:B,onDragLeave:z,onDrop:C,children:[t.jsx("input",{ref:c,type:"file",accept:u,onChange:i=>E(i.target.files),className:"hidden"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(U,{className:"mx-auto h-12 w-12 text-gray-400"}),t.jsx("div",{children:t.jsx(k,{type:"button",variant:"outline",onClick:()=>c.current?.click(),disabled:g||a.length>=e,className:"bg-gray-100 text-gray-600 border-gray-300 hover:bg-gray-200 hover:text-gray-700",children:g?t.jsxs(t.Fragment,{children:[t.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):t.jsxs(t.Fragment,{children:[t.jsx(O,{className:"mr-2 h-4 w-4"}),"Choose Image"]})})}),t.jsx("p",{className:"text-sm text-gray-500",children:"Or drag and drop an image here"}),t.jsxs("p",{className:"text-xs text-gray-400",children:[s==="profiles"?"Max 5MB":"Max 10MB"," â€¢ JPG, PNG, WebP, GIF"]})]})]}),a.length>0&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs(T,{children:["Uploaded Images (",a.length,"/",e,")"]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:a.map((i,d)=>t.jsxs("div",{className:"relative group",children:[t.jsx("img",{src:j.getOptimizedImageUrl(i,{width:200,height:150,quality:80}),alt:`Uploaded image ${d+1}`,className:"w-full h-24 object-cover rounded border",onError:S=>{S.currentTarget.src="https://via.placeholder.com/200x150?text=Error"}}),t.jsx(k,{type:"button",variant:"destructive",size:"sm",className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6 p-0",onClick:()=>I(i),children:t.jsx(L,{className:"h-3 w-3"})})]},d))})]}),t.jsxs(R,{children:[t.jsx(U,{className:"h-4 w-4"}),t.jsxs(M,{children:["Images are stored securely in Supabase Storage and automatically optimized for web delivery.",s==="profiles"?" Profile pictures are resized to maintain consistent display across the app.":" Project images support multiple formats and are perfect for showcasing your work progress."]})]})]})}export{K as F,j as I,q as S,J as a};
