import{j as e}from"./ui-B52-YLhK.js";import{r as n}from"./vendor-BcRnq7Bv.js";import{u as Q,r as i,C as o,b as u,e as m,S as N,B as h,t as x,I as A,i as P,j as F,k as E,l as I,m as p,d as v,f as b,A as B,n as q,o as z,s as O,h as c,w as W}from"./index-CwOpWW1C.js";import{d as L}from"./data-service-Cdw2IN4T.js";import{T as X,a as Z,b as w,c as _}from"./tabs-D5GWy4pF.js";import{D as ee,a as se,b as ae,c as re,d as te,e as ie}from"./dialog-C51BNC8a.js";import{T as le}from"./textarea-CV_jgnQH.js";import{P as de}from"./plus-B1hUgeE_.js";import{C as H}from"./clock-NqfEd9ie.js";import{C as V}from"./circle-check-CjnywA-A.js";import{f as T}from"./utils-BT0ItAA-.js";import"./supabase-B83k6j1z.js";function Ne(){const{profile:a}=Q(),[g,U]=n.useState([]),[Y,G]=n.useState([]),[R,D]=n.useState(!0),[$,k]=n.useState(!1),[r,d]=n.useState({title:"",description:"",assigned_to:"",due_date:"",priority:"medium"});n.useEffect(()=>{a&&j()},[a]);const j=async()=>{if(a)try{D(!0);const[s,t]=await Promise.all([L.getTasks(a.id,a.role),L.getEmployees()]);U(s),G(t)}catch(s){console.error("Error fetching data:",s),i.error("Failed to fetch data")}finally{D(!1)}},J=async s=>{if(s.preventDefault(),!!a){if(!r.title.trim()){i.error("Task title is required");return}if(!r.description.trim()){i.error("Task description is required");return}if(!r.assigned_to){i.error("Please select an employee to assign the task to");return}if(!a.department){i.error("Your profile is missing department information. Please update your profile.");return}try{const t={title:r.title.trim(),description:r.description.trim(),assigned_to:r.assigned_to,assigned_by:a.id,due_date:r.due_date||null,priority:r.priority,department:a.department||"General",status:"pending"},{error:l}=await O.from("tasks").insert(t).select(`
          *,
          assigned_to_profile:profiles!assigned_to(*),
          assigned_by_profile:profiles!assigned_by(*)
        `);if(l)throw console.error("Supabase error:",l),l;i.success("Task assigned successfully"),k(!1),d({title:"",description:"",assigned_to:"",due_date:"",priority:"medium"}),j()}catch(t){console.error("Error creating task:",t),t.message?.includes("foreign key")?i.error("Invalid employee selected. Please try again."):t.message?.includes("check constraint")?i.error("Invalid task data. Please check all fields."):i.error(`Failed to assign task: ${t.message||"Unknown error"}`)}}},C=async(s,t)=>{try{const{error:l}=await O.from("tasks").update({status:t,updated_at:new Date().toISOString()}).eq("id",s);if(l)throw l;i.success("Task status updated successfully"),j()}catch(l){console.error("Error updating task status:",l),i.error("Failed to update task status")}},f=s=>{switch(s){case"completed":return e.jsxs(c,{className:"bg-success text-success-foreground border-0",children:[e.jsx(V,{className:"mr-1 h-3 w-3"}),"Completed"]});case"in_progress":return e.jsxs(c,{className:"bg-primary text-primary-foreground border-0",children:[e.jsx(H,{className:"mr-1 h-3 w-3"}),"In Progress"]});default:return e.jsxs(c,{className:"bg-warning text-warning-foreground border-0",children:[e.jsx(W,{className:"mr-1 h-3 w-3"}),"Pending"]})}},y=s=>{switch(s){case"high":return e.jsx(c,{className:"bg-destructive text-destructive-foreground border-0",children:"High"});case"medium":return e.jsx(c,{className:"bg-orange-500 text-white border-0",children:"Medium"});default:return e.jsx(c,{variant:"outline",className:"border-muted-foreground/30",children:"Low"})}},S=g.filter(s=>s.assigned_to===a?.id),M=g.filter(s=>s.assigned_by===a?.id),K=()=>(a?.role==="manager"||a?.role==="super_admin")&&M.length>0?"assigned-by-me":"my-tasks";return R?e.jsxs("div",{className:"space-y-8 ",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-muted/30 rounded-2xl -z-10"}),e.jsx("div",{className:"p-8 space-y-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-2xl animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-64 animate-pulse"}),e.jsx("div",{className:"h-4 bg-muted rounded w-96 animate-pulse"})]})]})})]}),e.jsx("div",{className:"space-y-6",children:[...Array(3)].map((s,t)=>e.jsxs(o,{className:"border shadow-sm bg-card",children:[e.jsx(u,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-muted rounded-lg animate-pulse"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx("div",{className:"h-5 bg-muted rounded w-48 animate-pulse"}),e.jsx("div",{className:"h-4 bg-muted rounded w-32 animate-pulse"})]})]})}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-full animate-pulse"}),e.jsx("div",{className:"h-4 bg-muted rounded w-3/4 animate-pulse"})]})})]},t))})]}):e.jsxs("div",{className:"space-y-8 w-full overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-muted/30 rounded-2xl -z-10"}),e.jsx("div",{className:"p-4 sm:p-6 lg:p-8 space-y-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-4 sm:space-y-0 sm:space-x-4 min-w-0",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-primary rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(N,{className:"h-6 w-6 sm:h-8 sm:w-8 text-primary-foreground"})}),e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 sm:w-4 sm:h-4 bg-success rounded-full animate-pulse"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-primary-subtle break-words",children:"Task Management"}),e.jsx("p",{className:"text-sm sm:text-base lg:text-lg text-muted-foreground mt-1 sm:mt-2",children:"Organize and track tasks across your organization"})]})]}),(a?.role==="manager"||a?.role==="super_admin")&&e.jsx("div",{className:"flex-shrink-0",children:e.jsxs(ee,{open:$,onOpenChange:k,children:[e.jsx(se,{asChild:!0,children:e.jsxs(h,{className:"w-full sm:w-auto bg-primary text-primary-foreground hover:bg-primary/90 shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Assign New Task"}),e.jsx("span",{className:"sm:hidden",children:"New Task"})]})}),e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(te,{children:"Assign New Task"}),e.jsx(ie,{children:"Create and assign a new task to a team member"})]}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"title",children:"Task Title"}),e.jsx(A,{id:"title",placeholder:"Enter task title...",value:r.title,onChange:s=>d({...r,title:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"description",children:"Description"}),e.jsx(le,{id:"description",placeholder:"Describe the task details...",value:r.description,onChange:s=>d({...r,description:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"assigned_to",children:"Assign To"}),e.jsxs(P,{value:r.assigned_to,onValueChange:s=>d({...r,assigned_to:s}),children:[e.jsx(F,{children:e.jsx(E,{placeholder:"Select employee"})}),e.jsx(I,{children:Y.map(s=>e.jsxs(p,{value:s.id,children:[s.full_name," - ",s.job_title]},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"due_date",children:"Due Date (Optional)"}),e.jsx(A,{id:"due_date",type:"date",value:r.due_date,onChange:s=>d({...r,due_date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"priority",children:"Priority"}),e.jsxs(P,{value:r.priority,onValueChange:s=>d({...r,priority:s}),children:[e.jsx(F,{children:e.jsx(E,{})}),e.jsxs(I,{children:[e.jsx(p,{value:"low",children:"Low"}),e.jsx(p,{value:"medium",children:"Medium"}),e.jsx(p,{value:"high",children:"High"})]})]})]})]}),e.jsx(h,{type:"submit",className:"w-full bg-primary text-primary-foreground hover:bg-primary/90",children:"Assign Task"})]})]})]})})]})})]}),e.jsxs(X,{defaultValue:K(),className:"space-y-6",children:[e.jsxs(Z,{children:[e.jsx(w,{value:"my-tasks",children:"My Tasks"}),(a?.role==="manager"||a?.role==="super_admin")&&e.jsx(w,{value:"assigned-by-me",children:"Assigned by Me"}),a?.role==="super_admin"&&e.jsx(w,{value:"all-tasks",children:"All Tasks"})]}),e.jsx(_,{value:"my-tasks",className:"space-y-6",children:S.length===0?e.jsx(o,{className:"border shadow-sm bg-card",children:e.jsx(m,{className:"py-12",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-2xl flex items-center justify-center mx-auto",children:e.jsx(N,{className:"h-8 w-8 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"No tasks assigned"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"You don't have any tasks assigned to you yet"})]})]})})}):e.jsx("div",{className:"grid gap-6",children:S.map((s,t)=>e.jsxs(o,{className:"card-hover border shadow-sm bg-card group",children:[e.jsx(u,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-primary rounded-lg flex items-center justify-center shadow-sm group-hover:shadow-md transition-all duration-200 flex-shrink-0",children:e.jsx(N,{className:"h-4 w-4 sm:h-5 sm:w-5 text-primary-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(v,{className:"text-base sm:text-lg font-semibold break-words",children:s.title}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mt-1",children:[y(s.priority),s.due_date&&e.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm text-muted-foreground",children:[e.jsx(H,{className:"h-3 w-3"}),e.jsxs("span",{children:["Due: ",T(new Date(s.due_date),"MMM dd, yyyy")]})]})]})]})]}),e.jsxs(b,{className:"text-xs sm:text-sm truncate",children:["Assigned by ",s.assigned_by_profile.full_name]})]}),e.jsx("div",{className:"flex-shrink-0",children:f(s.status)})]})}),e.jsxs(m,{className:"pt-0",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mb-4 leading-relaxed break-words",children:s.description}),s.status!=="completed"&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[s.status==="pending"&&e.jsx(h,{onClick:()=>C(s.id,"in_progress"),size:"sm",className:"w-full sm:w-auto bg-primary text-primary-foreground hover:bg-primary/90 transition-all duration-200 hover:scale-105",children:"Start Task"}),s.status==="in_progress"&&e.jsxs(h,{onClick:()=>C(s.id,"completed"),className:"w-full sm:w-auto bg-success text-success-foreground hover:bg-success/90 transition-all duration-200 hover:scale-105",size:"sm",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Mark Complete"]})]})]})]},s.id))})}),(a?.role==="manager"||a?.role==="super_admin")&&e.jsx(_,{value:"assigned-by-me",className:"space-y-4",children:e.jsx("div",{className:"grid gap-4",children:M.map(s=>e.jsxs(o,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[s.title,y(s.priority)]}),e.jsxs(b,{className:"flex items-center gap-2 mt-2",children:[e.jsxs(B,{className:"h-5 w-5",children:[e.jsx(q,{src:s.assigned_to_profile.profile_picture||void 0}),e.jsx(z,{className:"text-xs",children:s.assigned_to_profile.full_name.split(" ").map(t=>t[0]).join("")})]}),s.assigned_to_profile.full_name,s.due_date&&e.jsxs("span",{children:[" â€¢ Due: ",T(new Date(s.due_date),"MMM dd, yyyy")]})]})]}),f(s.status)]})}),e.jsx(m,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})})]},s.id))})}),a?.role==="super_admin"&&e.jsx(_,{value:"all-tasks",className:"space-y-4",children:e.jsx("div",{className:"grid gap-4",children:g.map(s=>e.jsxs(o,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[s.title,y(s.priority)]}),e.jsxs(b,{className:"flex items-center gap-4 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Assigned to:"}),e.jsxs(B,{className:"h-5 w-5",children:[e.jsx(q,{src:s.assigned_to_profile.profile_picture||void 0}),e.jsx(z,{className:"text-xs",children:s.assigned_to_profile.full_name.split(" ").map(t=>t[0]).join("")})]}),s.assigned_to_profile.full_name]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"By:"}),s.assigned_by_profile.full_name]})]})]}),f(s.status)]})}),e.jsxs(m,{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),s.due_date&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Due: ",T(new Date(s.due_date),"MMM dd, yyyy")]})]})]},s.id))})})]})]})}export{Ne as Tasks};
