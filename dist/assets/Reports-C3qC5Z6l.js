import{j as e}from"./ui-B52-YLhK.js";import{r as h}from"./vendor-BcRnq7Bv.js";import{c as ae,u as re,s as x,i as A,j as U,k as H,l as I,m as j,B as le,C as l,b as n,d as i,U as ne,e as c,g as ie,S as ce,f as p,h as f}from"./index-CwOpWW1C.js";import{T as oe,a as de,b as w,c as k}from"./tabs-D5GWy4pF.js";import{T as me,a as q,C as z}from"./css-charts-CdCr8ooN.js";import{s as xe,b as pe}from"./utils-BT0ItAA-.js";import{T as ue}from"./triangle-alert-CUPz6xIU.js";import"./supabase-B83k6j1z.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=ae("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),m={primary:"#3b82f6",secondary:"#10b981",warning:"#f59e0b",danger:"#ef4444",purple:"#8b5cf6",pink:"#ec4899",indigo:"#6366f1",teal:"#14b8a6"},y=[m.primary,m.secondary,m.warning,m.danger,m.purple,m.pink,m.indigo,m.teal];function ke(){const{profile:D}=re(),[r,V]=h.useState(null),[F,O]=h.useState(!0),[L,M]=h.useState("30"),[o,K]=h.useState("all"),[G,J]=h.useState([]);h.useEffect(()=>{W(),Q()},[L,o]);const Q=async()=>{try{const{data:a}=await x.from("profiles").select("department").eq("is_active",!0),u=[...new Set(a?.map(d=>d.department)||[])];J(u)}catch(a){console.error("Error fetching departments:",a)}},W=async()=>{try{O(!0);const u=xe(new Date,parseInt(L)),d=o==="all"?{}:{department:o},{count:C}=await x.from("profiles").select("*",{count:"exact",head:!0}).match(d),{count:T}=await x.from("profiles").select("*",{count:"exact",head:!0}).eq("is_active",!0).match(d),{data:v}=await x.from("profiles").select("department").eq("is_active",!0).match(o==="all"?{}:d),{data:B}=await x.from("profiles").select("role").eq("is_active",!0).match(d),{count:S}=await x.from("profiles").select("*",{count:"exact",head:!0}).gte("joining_date",pe(new Date).toISOString()).match(d),{data:b}=await x.from("leave_requests").select(`
          *,
          profiles!leave_requests_employee_id_fkey(department)
        `).gte("created_at",u.toISOString()).match(o==="all"?{}:{"profiles.department":o}),{data:R}=await x.from("tasks").select("*").gte("created_at",u.toISOString()).match(o==="all"?{}:d),{data:_}=await x.from("project_updates").select(`
          *,
          profiles!project_updates_employee_id_fkey(department)
        `).gte("created_at",u.toISOString()).match(o==="all"?{}:{"profiles.department":o}),g=X({employees:{total:C||0,active:T||0,newHires:S||0},employeesByDept:v||[],employeesByRole:B||[],leaveRequests:b||[],tasks:R||[],projects:_||[]});V(g)}catch(a){console.error("Error fetching reports data:",a)}finally{O(!1)}},X=a=>{const u=a.employeesByDept.reduce((s,t)=>(t.department&&(s[t.department]=(s[t.department]||0)+1),s),{}),d=Object.entries(u).map(([s,t],N)=>({name:s,value:t,color:y[N%y.length]})),C=a.employeesByRole.reduce((s,t)=>(t.role&&(s[t.role]=(s[t.role]||0)+1),s),{}),T=Object.entries(C).map(([s,t])=>({name:s.replace("_"," ").toUpperCase(),value:t})),v=a.leaveRequests.reduce((s,t)=>(t.status&&(s[t.status]=(s[t.status]||0)+1),s),{}),B=a.leaveRequests.reduce((s,t)=>(t.leave_type&&(s[t.leave_type]=(s[t.leave_type]||0)+1),s),{}),S=Object.entries(B).map(([s,t],N)=>({name:s.toUpperCase(),value:t,color:y[N%y.length]})),b=a.tasks.reduce((s,t)=>(t.status&&(s[t.status]=(s[t.status]||0)+1),s),{}),R=a.tasks.reduce((s,t)=>(t.priority&&(s[t.priority]=(s[t.priority]||0)+1),s),{}),_=Object.entries(R).map(([s,t],N)=>({name:s.toUpperCase(),value:t,color:y[N%y.length]})),g=a.projects.reduce((s,t)=>(t.status&&(s[t.status]=(s[t.status]||0)+1),s),{}),Z=a.projects.reduce((s,t)=>(t.work_location&&(s[t.work_location]=(s[t.work_location]||0)+1),s),{}),$=Object.entries(Z).map(([s,t])=>({name:s,value:t})),P=a.tasks.length,E=b.completed||0,ee=P>0?E/P*100:0,se=a.leaveRequests.reduce((s,t)=>s+(t.days_count||0),0),te=a.leaveRequests.length>0?se/a.leaveRequests.length:0;return{totalEmployees:a.employees.total,activeEmployees:a.employees.active,employeesByDepartment:d,employeesByRole:T,newHiresThisMonth:a.employees.newHires,totalLeaveRequests:a.leaveRequests.length,approvedLeaves:v.approved||0,pendingLeaves:v.pending||0,rejectedLeaves:v.rejected||0,leavesByType:S,leavesByMonth:[],averageLeaveDays:te,totalTasks:P,completedTasks:E,pendingTasks:b.pending||0,overdueTasks:0,tasksByPriority:_,tasksByDepartment:[],taskCompletionRate:ee,totalProjects:a.projects.length,approvedProjects:g.approved||0,draftProjects:g.draft||0,submittedProjects:g.submitted||0,projectsByLocation:$,departmentPerformance:[]}},Y=()=>D?.role==="super_admin"?"employees":D?.role==="manager"?"tasks":"employees";return F?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading reports..."})]})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Reports & Analytics"}),e.jsx("p",{className:"text-muted-foreground",children:"Comprehensive insights into your organization"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(A,{value:L,onValueChange:M,children:[e.jsx(U,{className:"w-[180px]",children:e.jsx(H,{placeholder:"Select time range"})}),e.jsxs(I,{children:[e.jsx(j,{value:"7",children:"Last 7 days"}),e.jsx(j,{value:"30",children:"Last 30 days"}),e.jsx(j,{value:"90",children:"Last 3 months"}),e.jsx(j,{value:"365",children:"Last year"})]})]}),e.jsxs(A,{value:o,onValueChange:K,children:[e.jsx(U,{className:"w-[180px]",children:e.jsx(H,{placeholder:"Select department"})}),e.jsxs(I,{children:[e.jsx(j,{value:"all",children:"All Departments"}),G.map(a=>e.jsx(j,{value:a,children:a},a))]})]}),e.jsxs(le,{variant:"outline",size:"sm",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Total Employees"}),e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.totalEmployees}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.activeEmployees," active"]})]})]}),e.jsxs(l,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Task Completion"}),e.jsx(me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[r.taskCompletionRate.toFixed(1),"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.completedTasks," of ",r.totalTasks," tasks"]})]})]}),e.jsxs(l,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Leave Requests"}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.totalLeaveRequests}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.pendingLeaves," pending approval"]})]})]}),e.jsxs(l,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(i,{className:"text-sm font-medium",children:"Project Updates"}),e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.totalProjects}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.approvedProjects," approved"]})]})]})]}),e.jsxs(oe,{defaultValue:Y(),className:"space-y-6",children:[e.jsxs(de,{className:"grid w-full grid-cols-4",children:[e.jsx(w,{value:"employees",children:"Employees"}),e.jsx(w,{value:"tasks",children:"Tasks"}),e.jsx(w,{value:"leaves",children:"Leaves"}),e.jsx(w,{value:"projects",children:"Projects"})]}),e.jsx(k,{value:"employees",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsxs(n,{children:[e.jsx(i,{children:"Employees by Department"}),e.jsx(p,{children:"Distribution of employees across departments"})]}),e.jsx(c,{children:r.employeesByDepartment.length>0?e.jsx("div",{className:"flex justify-center",children:e.jsx(q,{data:r.employeesByDepartment,size:200,showLabels:!0,showLegend:!0})}):e.jsx("div",{className:"flex items-center justify-center h-[200px] text-muted-foreground",children:"No department data available"})})]}),e.jsxs(l,{children:[e.jsxs(n,{children:[e.jsx(i,{children:"Employees by Role"}),e.jsx(p,{children:"Role distribution in the organization"})]}),e.jsx(c,{children:r.employeesByRole.length>0?e.jsx(z,{data:r.employeesByRole.map(a=>({name:a.name,value:a.value,color:m.primary})),height:300,showValues:!0,showLabels:!0}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-muted-foreground",children:"No role data available"})})]})]})}),e.jsx(k,{value:"tasks",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsxs(n,{children:[e.jsx(i,{children:"Tasks by Priority"}),e.jsx(p,{children:"Task distribution by priority level"})]}),e.jsx(c,{children:r.tasksByPriority.length>0?e.jsx("div",{className:"flex justify-center",children:e.jsx(q,{data:r.tasksByPriority,size:200,showLabels:!0,showLegend:!0})}):e.jsx("div",{className:"flex items-center justify-center h-[200px] text-muted-foreground",children:"No task priority data available"})})]}),e.jsxs(l,{children:[e.jsxs(n,{children:[e.jsx(i,{children:"Task Status Overview"}),e.jsx(p,{children:"Current status of all tasks"})]}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Completed"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:r.completedTasks})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Pending"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:r.pendingTasks})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Overdue"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:r.overdueTasks})]}),e.jsxs("div",{className:"pt-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-center",children:[r.taskCompletionRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"Completion Rate"})]})]})})]})]})}),e.jsx(k,{value:"leaves",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsxs(n,{children:[e.jsx(i,{children:"Leave Requests by Type"}),e.jsx(p,{children:"Distribution of leave types requested"})]}),e.jsx(c,{children:r.leavesByType.length>0?e.jsx("div",{className:"flex justify-center",children:e.jsx(q,{data:r.leavesByType,size:200,showLabels:!0,showLegend:!0})}):e.jsx("div",{className:"flex items-center justify-center h-[200px] text-muted-foreground",children:"No leave type data available"})})]}),e.jsxs(l,{children:[e.jsxs(n,{children:[e.jsx(i,{children:"Leave Statistics"}),e.jsx(p,{children:"Key leave metrics and trends"})]}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Approved"}),e.jsx(f,{variant:"secondary",children:r.approvedLeaves})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Pending"}),e.jsx(f,{variant:"outline",children:r.pendingLeaves})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Rejected"}),e.jsx(f,{variant:"destructive",children:r.rejectedLeaves})]}),e.jsxs("div",{className:"pt-4",children:[e.jsx("div",{className:"text-2xl font-bold text-center",children:r.averageLeaveDays.toFixed(1)}),e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"Average Days per Request"})]})]})})]})]})}),e.jsx(k,{value:"projects",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsxs(n,{children:[e.jsx(i,{children:"Projects by Location"}),e.jsx(p,{children:"Distribution of project work locations"})]}),e.jsx(c,{children:r.projectsByLocation.length>0?e.jsx(z,{data:r.projectsByLocation.map(a=>({name:a.name,value:a.value,color:m.secondary})),height:300,showValues:!0,showLabels:!0}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-muted-foreground",children:"No project location data available"})})]}),e.jsxs(l,{children:[e.jsxs(n,{children:[e.jsx(i,{children:"Project Status Overview"}),e.jsx(p,{children:"Current status of all project updates"})]}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Approved"}),e.jsx(f,{variant:"secondary",children:r.approvedProjects})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Submitted"}),e.jsx(f,{variant:"outline",children:r.submittedProjects})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Draft"}),e.jsx(f,{variant:"secondary",children:r.draftProjects})]}),e.jsxs("div",{className:"pt-4",children:[e.jsx("div",{className:"text-2xl font-bold text-center",children:r.totalProjects}),e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"Total Project Updates"})]})]})})]})]})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ue,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Unable to load reports"}),e.jsx("p",{className:"text-muted-foreground",children:"Please try again later."})]})}export{ke as Reports};
